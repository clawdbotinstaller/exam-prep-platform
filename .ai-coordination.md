# AI Coordination File

**Last Updated**: 2026-02-07T22:00:00Z
**Project**: Arkived (Exam Prep Platform)

## Current Status

### Claude #2 (PID: 71820) - In Progress - Landing Page Improvements
- **Session ID**: 5fd29aa7-d965-46e4-b853-5e154d0e685f (long-running session)
- **Task**: Improving landing page design and content
- **Working On**:
  - frontend/src/sections/HeroSection.tsx
  - frontend/src/sections/Navigation.tsx
  - frontend/src/sections/ContactSection.tsx (content updates)
- **Status**: in_progress
- **Blocked By**: None

### Claude #1 (PID: 25480) - Design Phase Complete - Course Analysis Redesign
- **Session ID**: current session
- **Task**: Course Analysis section redesign (design complete, ready for implementation)
- **Working On**:
  - Design document: `docs/designs/course-analysis-redesign.md`
  - Implementation plan: `docs/plans/course-analysis-implementation-plan.md`
- **Status**: design_complete
- **Blocked By**: None
- **Build Status**: ✅ Frontend builds successfully
- **Next**: Ready for implementation (see plan for 12 tasks)

### Codex (Next)
- **Task**: Available for frontend/backend tasks
- **Status**: waiting

## Recent Changes (Last 10)

1. **[CLAUDE]** Fixed API endpoint integration issues (TopicAnalysisDetail, contact form, totalExams)
2. **[CLAUDE]** Created Course Analysis redesign design document and implementation plan
3. **[CLAUDE]** Identified question count discrepancy (7 IBP questions exist but section shows 2)
4. **[CLAUDE]** Added public API endpoints for landing page (/api/topics, /api/questions/public)
5. **[CLAUDE]** Fixed Hono route ordering for /api/courses/:id/topics/public
6. **[CLAUDE]** Fixed TypeScript errors in CourseLayout.tsx
7. **[CLAUDE]** Fixed API integration - made /api/courses public
8. **[CLAUDE]** Added /api/midterm/presets endpoint
9. **[CLAUDE]** Deployed updated worker and frontend
10. **[CLAUDE]** Verified all API endpoints working end-to-end
11. **[CLAUDE]** Removed hardcoded fallback data from QuestionSpotlight
12. **[CLAUDE]** Removed hardcoded fallback data from TopicDeepDive

## Next Priority Tasks

### Course Analysis Redesign (Ready for Implementation)
- **Design Document**: `docs/designs/course-analysis-redesign.md`
- **Implementation Plan**: `docs/plans/course-analysis-implementation-plan.md`

**Phase 1 Tasks (Can start immediately):**
- [ ] T1: Add KaTeX dependency and LatexRenderer
- [ ] T2: Create Shared UI Components (Stamps, Cards)
- [ ] T8: Update API for Global Technique Counts

**Key Issues Addressed:**
1. Question count shows "2 IBP" when there are actually 7 across all sections
2. LaTeX is stripped instead of rendered (`.replace(/\\\w+/g, '')`)
3. Step-by-step solutions are summaries, not actual steps
4. UI drifts from engineering library aesthetic

## API Status

| Endpoint | Status | Notes |
|----------|--------|-------|
| /api/health | ✅ Working | |
| /api/auth/login | ✅ Working | test@example.com / test123 |
| /api/auth/me | ✅ Working | |
| /api/credits/balance | ✅ Working | |
| /api/courses | ✅ Working | |
| /api/courses/:id/topics | ✅ Working | 15 topics seeded |
| /api/courses/:id/questions | ✅ Working | Returns LaTeX content |
| /api/midterm/generate | ✅ Working | Defaults to calc2 |
| /api/contact | ✅ Working | Stores contact form submissions |
| /api/midterm/presets | ✅ Working | Returns 4 preset configurations |
| /api/topics | ✅ Working | Public - all topics for calc2 |
| /api/questions/public | ✅ Working | Public - questions without auth |
| /api/courses/:id/topics/public | ✅ Working | Public - topics without auth |
| /api/topics/:topicId/public | ✅ Working | Public - topic detail with questions |

## Database Schema

### users
- id, email, password_hash, credits, has_unlimited, unlimited_until, credits_reset_at

### topics (15 seeded)
- integration_by_parts, trig_integrals, trig_substitution, partial_fractions, improper_integrals
- arc_length, surface_area, center_of_mass
- series_basics, integral_test, comparison_tests, alternating_series, ratio_root_tests, power_series, taylor_series

### questions
- 33 questions from 5 MTH240 exams
- question_text contains LaTeX like `$\int \tan^{5}(x) \sec^{6}(x) dx$`

### contact_submissions
- id, name, email, subject, message, page_url, user_agent, status, created_at
- Stores contact form submissions with error reports

## Environment

- **Worker URL**: https://arkived.clawdbotinstaller.workers.dev
- **Database**: testament-db (D1)
- **Test Users**:
  - test@example.com / test123 (1 credit)
  - unlimited@example.com / test123 (unlimited)

## Handoff Notes

### For Next AI Instance

1. **LaTeX Rendering**: Just installed react-katex. Questions now render properly with `<LatexRenderer tex={...} />`

2. **If questions fail to load**: Check:
   - API endpoint: /api/courses/calc2/questions?limit=N
   - Auth token required
   - Questions exist in DB (33 seeded)

3. **Error Handling Pattern**: Use ErrorApology component for consistent error UX:
   ```tsx
   import ErrorApology from '../components/ErrorApology';

   // In render:
   {error && (
     <ErrorApology
       title="We're sorry, something went wrong"
       message="We couldn't load this content. This might be a temporary issue."
       errorDetails={error}
       onRetry={() => window.location.reload()}
     />
   )}
   ```

4. **Known Issues**:
   - Frontend build can fail on unused variables (TypeScript strict)
   - ~Some sections still use hardcoded data~ ✅ Fixed
   - ~Contact form not wired to backend yet~ ✅ Fixed

5. **Next Priority Tasks**:
   - [x] Fix ContactSection form submission (endpoint exists at /api/contact)
   - [ ] Deploy worker to production with new contact endpoint
   - [ ] Add proper error boundaries
   - [ ] Test midterm generation flow end-to-end
   - [ ] Stripe integration for payments

## Communication Protocol

1. **Before Starting**: Read this file, check git status
2. **After Changes**: Update this file with your changes
3. **Git Commits**: Use prefix `[CLAUDE]` or `[CODEX]` in commit messages
4. **Conflicts**: If both working, use different branches

## Commands

```bash
# Check API health
curl https://arkived.clawdbotinstaller.workers.dev/api/health

# Build frontend
cd frontend && npm run build

# Deploy worker
cd worker && wrangler deploy

# Check DB tables
wrangler d1 execute testament-db --remote --command="SELECT name FROM sqlite_master WHERE type='table'"
```

---

# AI Instance Behavior Protocol

**READ THIS SECTION BEFORE MAKING ANY CHANGES**

## 1. Mandatory Pre-Work Checklist

Before starting ANY task, you MUST:

- [ ] Read this entire `.ai-coordination.md` file
- [ ] Check "Current Status" to see if another AI is working
- [ ] Run `git status` to see uncommitted changes
- [ ] Check the last 5 commits: `git log --oneline -5`
- [ ] Verify frontend builds: `cd frontend && npm run build`

## 2. Status Update Protocol

**When starting work:**
1. Update "Current Status" section with your name (Claude/Codex) and task
2. Set status to "in_progress"
3. Note any files you plan to modify
4. Update the timestamp

**When completing work:**
1. Update status to "completed"
2. Add your changes to "Recent Changes" list
3. Update any relevant API/Database documentation
4. Update the timestamp

**When blocked:**
1. Set status to "blocked"
2. Note what you're blocked by
3. Leave detailed notes for the next AI

## 3. Git Commit Rules

**Commit Message Format:**
```
[AI-NAME] type: brief description

- Detail 1
- Detail 2
```

**Examples:**
```
[CLAUDE] fix: resolve LaTeX rendering in ArchiveBrowse

- Installed react-katex
- Created LatexRenderer component
- Updated ArchiveBrowse to use component
```

```
[CODEX] feat: add Stripe payment integration

- Added Stripe checkout page
- Created payment webhook handler
- Updated credits balance after payment
```

**NEVER commit:**
- Without reading `.ai-coordination.md` first
- Without checking if another AI is working on the same files
- Breaking changes without documenting them

## 4. File Modification Rules

**Before editing a file:**
1. Check if it's listed in another AI's "Files Modified"
2. If yes, communicate or choose different files
3. If must edit, document the conflict in this file

**After editing a file:**
1. Add it to your "Files Modified" list
2. Note what you changed and why
3. Update the "Last Updated" timestamp

## 5. Conflict Resolution

**If you find uncommitted changes by another AI:**

1. **DON'T** discard them automatically
2. Read the code to understand what they were doing
3. Try to preserve their work if possible
4. If you must override, document why in this file
5. If merging is complex, ask the user for help

**If you and another AI are working simultaneously:**

1. Coordinate through this file
2. Work on different files when possible
3. If same file needed:
   - One AI creates a branch: `git checkout -b feature/xyz`
   - Other AI works on main or different branch
   - Merge when both done

## 6. Build & Deploy Rules

**NEVER deploy if:**
- Frontend build fails (`npm run build`)
- TypeScript has errors
- Tests fail (if any exist)
- You haven't tested your changes locally

**Always test these after changes:**
- Login: `test@example.com` / `test123`
- API Health: `/api/health`
- Questions load: `/api/courses/calc2/questions`
- LaTeX renders properly

## 7. Error Handling Standards

**When adding error handling:**

1. Use the `ErrorApology` component for UI errors:
   ```tsx
   import ErrorApology from '../components/ErrorApology';

   {error && (
     <ErrorApology
       title="We're sorry, something went wrong"
       message="We couldn't load this content."
       errorDetails={error}
       onRetry={fetchData}
     />
   )}
   ```

2. Always log errors to console with context:
   ```typescript
   console.error('Failed to load questions:', err);
   ```

3. Show user-friendly messages, not raw errors

## 8. Code Style Requirements

**TypeScript:**
- NO unused variables (build will fail)
- NO implicit any types
- Proper error types: `Error | unknown`

**Imports:**
- Remove unused imports before committing
- Group: React → Libraries → Local components → Utils

**Components:**
- Use functional components with hooks
- Proper TypeScript interfaces for props
- Loading states for async data
- Error states with ErrorApology

## 9. Communication Template

**When handing off work, use this format:**

```markdown
### [AI-NAME] - [STATUS]

**Task**: What you were working on
**Status**: in_progress / completed / blocked
**Files Modified**:
- file/path.tsx - what you changed
- file/path.ts - what you changed

**Notes for Next AI**:
- Important context they need
- Known issues
- Suggested next steps

**Build Status**: ✅ / ❌
```

## 10. Emergency Procedures

**If you break the build:**
1. Stop immediately
2. Document what you were trying to do
3. Revert if you can't fix quickly
4. Update this file with what went wrong

**If you notice the site is down:**
1. Check `/api/health` endpoint
2. Check wrangler logs if needed
3. Document issue in this file
4. Notify user if critical

**If database changes fail:**
1. Never run destructive migrations without backup plan
2. Test on local first
3. Document schema changes here
4. Coordinate with other AIs

## 11. Quick Reference

**Project Structure:**
```
exam-prep-platform/
├── frontend/          # React + Vite app
│   ├── src/
│   │   ├── components/
│   │   ├── pages/
│   │   └── sections/
│   └── package.json
├── worker/            # Cloudflare Worker
│   ├── src/index.ts   # Main API code
│   └── public/        # Static assets
└── .ai-coordination.md   # THIS FILE
```

**Important Files:**
- `worker/src/index.ts` - All API endpoints
- `frontend/src/lib/api.ts` - API client
- `frontend/src/components/ErrorApology.tsx` - Error component
- `frontend/src/components/LatexRenderer.tsx` - Math rendering

**Test Credentials:**
- Regular: `test@example.com` / `test123` (1 credit)
- Unlimited: `unlimited@example.com` / `test123`

**Live URL:** https://arkived.clawdbotinstaller.workers.dev

---

## AI Instance Sign-Off

**Current AI**: Claude (Opus 4.5) - PID: 5fd29aa7-d965-46e4-b853-5e154d0e685f
**Started**: 2026-02-07T20:45:00Z
**Task**: Fixed API integration issues - made /api/courses public, added /api/midterm/presets endpoint, deployed updated worker and frontend
**Status**: completed

I have read and agree to follow the AI Instance Behavior Protocol.
